<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>GALAXY SALOON | Full Admin Sync</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Hindi:wght@400;700&family=Syncopate:wght@700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <style>
        :root { --accent: #ff8c00; --bg: #f8fafc; --surface: #ffffff; --text: #0f172a; --text-dim: #64748b; --border: rgba(0, 0, 0, 0.08); }
        [data-theme="dark"] { --bg: #020617; --surface: #0f172a; --text: #f8fafc; --text-dim: #94a3b8; --border: rgba(255, 255, 255, 0.1); }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; transition: background 0.3s; }
        body { background: var(--bg); color: var(--text); font-family: 'Inter', 'Noto Sans Hindi', sans-serif; margin: 0; height: 100vh; overflow: hidden; }
        .nav { position: fixed; top: 0; width: 100%; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; z-index: 1000; background: var(--bg); }
        .circle-btn { width: 40px; height: 40px; border-radius: 50%; background: var(--surface); border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .view { display: none; height: 100vh; padding: 70px 15px 20px; flex-direction: column; overflow-y: auto; align-items: center; }
        .view.active { display: flex; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* CENTERED LANDING PAGE - CENTERED */
        #view-landing { justify-content: center; text-align: center; padding-top: 0; }
        .hero-img-container { width: 180px; height: 180px; border-radius: 50%; border: 4px solid var(--accent); padding: 5px; box-shadow: 0 0 20px var(--accent); margin: 0 auto 20px; }
        .hero-img-container img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; }

        /* CARDS */
        .barber-grid, .gender-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; max-width: 400px; }
        .barber-card, .gender-card { background: var(--surface); border-radius: 24px; padding: 20px; text-align: center; border: 2.5px solid transparent; cursor: pointer; display: flex; flex-direction: column; align-items: center; }
        .barber-card img { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; margin-bottom: 12px; border: 2px solid var(--border); }
        .active-card { border-color: var(--accent) !important; background: rgba(255, 140, 0, 0.05) !important; }

        /* SQUARE SERVICE GRID */
        .service-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; width: 100%; }
        .s-card { aspect-ratio: 1/1; background: var(--surface); border: 1px solid var(--border); border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 5px; cursor: pointer; }
        .s-card.active { background: var(--accent); color: #000; border-color: var(--accent); }
        .s-card b { font-size: 0.5rem; text-transform: uppercase; margin-top: 4px; text-align: center; }
        .hidden-s { display: none; }

        /* ADMIN PILL GRID */
        .admin-service-pills { display: flex; flex-wrap: wrap; gap: 6px; width: 100%; }
        .s-pill { padding: 6px 12px; border-radius: 20px; border: 1px solid var(--border); font-size: 0.6rem; background: var(--surface); cursor: pointer; }
        .s-pill.active { background: var(--accent); color: #000; }

        /* DROPDOWN PILLS TIMING */
        .module { background: var(--surface); border-radius: 20px; padding: 12px; width: 100%; border: 1px solid var(--border); margin-bottom: 10px; }
        .label { font-size: 0.65rem; font-weight: 700; color: var(--text-dim); text-transform: uppercase; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
        .time-pill { background: var(--bg); border: 1px solid var(--border); border-radius: 30px; padding: 12px 18px; margin-bottom: 8px; cursor: pointer; display: flex; justify-content: space-between; font-size: 0.75rem; font-weight: 600; }
        .sub-grid { display: none; grid-template-columns: repeat(4, 1fr); gap: 6px; padding: 10px 0; }
        .sub-grid.active { display: grid; }
        .t-chip { padding: 10px 0; background: var(--surface); border: 1px solid var(--border); border-radius: 10px; text-align: center; font-size: 0.6rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .t-chip.selected { border-color: var(--accent); color: var(--accent); background: rgba(255, 140, 0, 0.1); }
        .booked { opacity: 0.3; text-decoration: line-through; pointer-events: none; }
        .admin-booked { background: #fee2e2 !important; color: #b91c1c !important; opacity: 1 !important; border-color: #fca5a5 !important; font-weight: bold; text-decoration: none !important; cursor: pointer !important; }

        /* GENERAL UI */
        .btn-magma { width: 100%; max-width: 320px; padding: 18px; border-radius: 18px; border: none; background: var(--accent); color: #000; font-weight: 700; cursor: pointer; }
        .scroll-x { display: flex; overflow-x: auto; gap: 8px; width: 100%; scrollbar-width: none; }
        .date-chip { min-width: 50px; height: 65px; border-radius: 15px; border: 1px solid var(--border); display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; }
        .date-chip.active { background: var(--accent); color: #000; }

        /* MODALS */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(10px); display: none; align-items: center; justify-content: center; z-index: 2000; padding: 20px; }
        .modal.active { display: flex; }
        .modal-box { width: 100%; max-width: 360px; background: var(--surface); padding: 30px; border-radius: 25px; }
        input, select { width: 100%; background: var(--bg); border: 1px solid var(--border); padding: 15px; border-radius: 10px; color: var(--text); margin-bottom: 15px; font-family: inherit; }
    </style>
</head>
<body data-theme="dark">

<div class="nav">
    <div style="font-family:'Syncopate'; font-size:0.7rem; color:var(--accent);">GALAXY üíà</div>
    <div style="display:flex; gap:10px;">
        <div class="circle-btn" onclick="toggleTheme()">üåì</div>
        <div class="circle-btn" onclick="openAdminLogin()">üë§</div>
    </div>
</div>

<div id="view-landing" class="view active">
    <div class="hero-img-container"><img src="images/g.jpg"></div>
    <h1 style="font-family:'Syncopate'; font-size:1.1rem; letter-spacing:4px; color:var(--accent);">GALAXY SALOON</h1>
    <div style="display:flex; gap:12px; margin-top:25px; width: 100%; justify-content: center;">
        <button class="btn-magma" style="max-width: 130px;" onclick="setLang('en')">ENGLISH</button>
        <button class="btn-magma" style="background:#444; color:white; font-family:'Noto Sans Hindi'; max-width: 140px;" onclick="setLang('hi')">‡§π‡§ø‡§Ç‡§¶‡•Ä</button>
    </div>
</div>

<div id="view-selection" class="view">
    <span class="label" id="lbl-barber">‚úÇÔ∏è SELECT SPECIALIST</span>
    <div class="barber-grid">
        <div class="barber-card" onclick="selectItem('barber', 'Yogesh Wagh', this)">
            <img src="images/y.jpg"><b id="nm-yogesh">YOGESH WAGH</b>
        </div>
        <div class="barber-card" onclick="selectItem('barber', 'Raju Wagh', this)">
            <img src="images/r.jpg"><b id="nm-raju">RAJU WAGH</b>
        </div>
    </div>
    <span class="label" id="lbl-gender" style="margin-top:20px;">üë§ CATEGORY</span>
    <div class="gender-grid">
        <div class="gender-card" id="gen-male" onclick="selectItem('gender', 'Male', this)">ü§µ <span id="txt-male">MALE</span></div>
        <div class="gender-card" id="gen-female" onclick="selectItem('gender', 'Female', this)">üíÉ <span id="txt-female">FEMALE</span></div>
    </div>
    <button class="btn-magma" id="next-btn" disabled onclick="showView('view-booking')">CONTINUE ‚ûî</button>
</div>

<div id="view-booking" class="view">
    <div id="admin-banner" style="display:none; color:red; font-size:0.6rem; font-weight:800; margin-bottom:10px;">‚ö†Ô∏è ADMIN: <span id="logged-barber"></span></div>
    <div class="module">
        <span class="label" id="lbl-services">üõ†Ô∏è SERVICES</span>
        <div id="service-container"></div>
        <div onclick="toggleAllS()" id="view-all-btn" style="text-align:center; font-size:0.55rem; color:var(--accent); font-weight:700; margin-top:10px; cursor:pointer;">VIEW ALL ‚ñº</div>
    </div>
    <div class="module">
        <div class="label"><span id="lbl-cal">üìÖ CALENDAR</span> <span onclick="document.getElementById('hidden-picker').showPicker()" style="cursor:pointer">üìÖ</span></div>
        <input type="date" id="hidden-picker" style="position:absolute; opacity:0; pointer-events:none;" onchange="manualDate(this.value)">
        <div class="scroll-x" id="date-ribbon"></div>
    </div>
    <div class="module">
        <span class="label" id="lbl-timing">‚è∞ TIMING GROUPS</span>
        <div class="time-pill" onclick="togglePill(this)"><span id="p-morning">Morning</span> <span>‚ñº</span></div>
        <div id="morning-grid" class="sub-grid"></div>
        <div class="time-pill" onclick="togglePill(this)"><span id="p-afternoon">Afternoon</span> <span>‚ñº</span></div>
        <div id="afternoon-grid" class="sub-grid"></div>
        <div class="time-pill" onclick="togglePill(this)"><span id="p-evening">Evening</span> <span>‚ñº</span></div>
        <div id="evening-grid" class="sub-grid"></div>
    </div>
    <button class="btn-magma" id="book-btn" disabled onclick="openActionModal()">BOOK NOW üìÖ</button>
</div>

<div id="details-modal" class="modal">
    <div class="modal-box">
        <h3 id="lbl-details">üìù Details</h3>
        <input type="text" id="cust-name" placeholder="Client Name">
        <input type="tel" id="cust-phone" placeholder="10 Digit Number" maxlength="10">
        <button class="btn-magma" onclick="finalize()">CONFIRM ‚úÖ</button>
        <button onclick="closeModal('details-modal')" style="background:none; border:none; color:red; margin-top:15px; width:100%;">Cancel</button>
    </div>
</div>

<div id="admin-modal" class="modal"><div class="modal-box"><h3>üîê Login</h3><input type="password" id="admin-pin" placeholder="PIN"><button class="btn-magma" onclick="adminLogin()">LOG IN ‚ûî</button></div></div>

<div id="edit-modal" class="modal">
    <div class="modal-box">
        <h4 id="edit-client-name" style="margin-top:0">‚öôÔ∏è Manage</h4>
        <label style="font-size:0.6rem;">üìÖ CHANGE DATE</label><input type="date" id="edit-date">
        <label style="font-size:0.6rem;">‚è∞ CHANGE TIME</label><select id="edit-time-select"></select>
        <button class="btn-magma" onclick="saveEdit()">SAVE üíæ</button>
        <button class="btn-magma" style="background:red; color:white; margin-top:10px;" onclick="deleteBooking()">CANCEL üóëÔ∏è</button>
        <button onclick="closeModal('edit-modal')" style="background:none; border:none; width:100%; margin-top:15px;">Close</button>
    </div>
</div>

<script>
    // --- FIREBASE LIVE CONFIG ---
    const firebaseConfig = { databaseURL: "https://ankit-aeb2c-default-rtdb.firebaseio.com/" };
    firebase.initializeApp(firebaseConfig);
    const dbRef = firebase.database().ref('bookings');

    const WA = "919131934362";
    let db = []; 
    let state = { lang:'en', isAdmin:false, loggedBarber:'', barber:'', gender:'', services:[], date:new Date().toISOString().split('T')[0], time:null, activeBookingId: null, activeFirebaseKey: null, showAll: false };
    const pins = {"1111":"Yogesh Wagh", "2222":"Raju Wagh"};

    const dict = {
        hi: { b:"‚úÇÔ∏è ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û ‡§ö‡•Å‡§®‡•á‡§Ç", yogesh:"‡§Ø‡•ã‡§ó‡•á‡§∂ ‡§µ‡§æ‡§ò", raju:"‡§∞‡§æ‡§ú‡•Ç ‡§µ‡§æ‡§ò", g:"üë§ ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§∂‡•ç‡§∞‡•á‡§£‡•Ä", male:"‡§™‡•Å‡§∞‡•Å‡§∑", female:"‡§Æ‡§π‡§ø‡§≤‡§æ", s:"üõ†Ô∏è ‡§∏‡•á‡§µ‡§æ‡§è‡§Ç", m:"‡§∏‡•Å‡§¨‡§π", a:"‡§¶‡•ã‡§™‡§π‡§∞", e:"‡§∂‡§æ‡§Æ", next:"‡§ú‡§æ‡§∞‡•Ä ‡§∞‡§ñ‡•á‡§Ç ‚ûî", book:"‡§Ö‡§≠‡•Ä ‡§¨‡•Å‡§ï ‡§ï‡§∞‡•á‡§Ç üìÖ", det:"üìù ‡§µ‡§ø‡§µ‡§∞‡§£", cal:"üìÖ ‡§ï‡•à‡§≤‡•á‡§Ç‡§°‡§∞" },
        en: { b:"‚úÇÔ∏è SELECT SPECIALIST", yogesh:"YOGESH WAGH", raju:"RAJU WAGH", g:"üë§ CATEGORY", male:"MALE", female:"FEMALE", s:"üõ†Ô∏è SERVICES", m:"Morning", a:"Afternoon", e:"Evening", next:"CONTINUE ‚ûî", book:"BOOK NOW üìÖ", det:"üìù Details", cal:"üìÖ CALENDAR" }
    };

    const servicesList = [
        {id:'Cutting', en:'Cutting', hi:'‡§ï‡§ü‡§ø‡§Ç‡§ó'}, {id:'Shaving', en:'Shaving', hi:'‡§∂‡•á‡§µ‡§ø‡§Ç‡§ó'},
        {id:'Wax', en:'Waxing', hi:'‡§µ‡•à‡§ï‡•ç‡§∏‡§ø‡§Ç‡§ó'}, {id:'Facial', en:'Facial', hi:'‡§´‡•á‡§∂‡§ø‡§Ø‡§≤'},
        {id:'Threading', en:'Threading', hi:'‡§•‡•ç‡§∞‡•á‡§°‡§ø‡§Ç‡§ó'}, {id:'Treatment', en:'Treatment', hi:'‡§ü‡•ç‡§∞‡•Ä‡§ü‡§Æ‡•á‡§Ç‡§ü'},
        {id:'Color', en:'Color', hi:'‡§ï‡§≤‡§∞'}, {id:'Marriage', en:'Marriage', hi:'‡§∂‡§æ‡§¶‡•Ä'}
    ];

    // FETCH FROM FIREBASE
    dbRef.on('value', (snap) => {
        const val = snap.val();
        db = val ? Object.keys(val).map(key => ({ ...val[key], firebaseKey: key })) : [];
        if(document.getElementById('view-booking').classList.contains('active')) renderTimes();
    });

    function setLang(l) {
        state.lang = l; const d = dict[l];
        document.getElementById('lbl-barber').innerText = d.b; document.getElementById('nm-yogesh').innerText = d.yogesh; document.getElementById('nm-raju').innerText = d.raju;
        document.getElementById('lbl-gender').innerText = d.g; document.getElementById('txt-male').innerText = d.male; document.getElementById('txt-female').innerText = d.female;
        document.getElementById('lbl-services').innerText = d.s; document.getElementById('p-morning').innerText = d.m; document.getElementById('p-afternoon').innerText = d.a;
        document.getElementById('p-evening').innerText = d.e; document.getElementById('next-btn').innerText = d.next; document.getElementById('book-btn').innerText = d.book;
        document.getElementById('lbl-details').innerText = d.det; document.getElementById('lbl-cal').innerText = d.cal; showView('view-selection');
    }

    function toggleTheme() { document.body.setAttribute('data-theme', document.body.getAttribute('data-theme')==='dark'?'light':'dark'); }
    function showView(v) { document.querySelectorAll('.view').forEach(x=>x.classList.remove('active')); document.getElementById(v).classList.add('active'); if(v==='view-booking') initBooking(); }
    function closeModal(id) { document.getElementById(id).classList.remove('active'); }

    function selectItem(type, val, el) {
        state[type] = val; el.parentElement.querySelectorAll('div').forEach(x=>x.classList.remove('active-card')); el.classList.add('active-card');
        if(state.barber && state.gender) document.getElementById('next-btn').disabled = false;
    }

    function toggleS(id, el) {
        if(state.services.includes(id)) state.services = state.services.filter(x=>x!==id); else state.services.push(id);
        el.classList.toggle('active'); validate();
    }

    function renderServices() {
        const container = document.getElementById('service-container');
        if(state.isAdmin) {
            container.className = "admin-service-pills";
            container.innerHTML = servicesList.map(s => `<div class="s-pill ${state.services.includes(s.id)?'active':''}" onclick="toggleS('${s.id}', this)">${state.lang==='hi'?s.hi:s.en}</div>`).join('');
            document.getElementById('view-all-btn').style.display = 'none';
        } else {
            container.className = "service-grid";
            container.innerHTML = servicesList.map((s, i) => `<div class="s-card ${state.services.includes(s.id)?'active':''} ${i>3 && !state.showAll ? 'hidden-s' : ''}" onclick="toggleS('${s.id}', this)"><b>${state.lang==='hi'?s.hi:s.en}</b></div>`).join('');
            document.getElementById('view-all-btn').style.display = 'block';
        }
    }

    function initBooking() {
        renderServices();
        const rib = document.getElementById('date-ribbon'); rib.innerHTML = '';
        let start = new Date(state.date);
        for(let i=0; i<12; i++) {
            let d = new Date(start); d.setDate(d.getDate() + i); let iso = d.toISOString().split('T')[0];
            let item = document.createElement('div');
            item.className = `date-chip ${iso === state.date ? 'active' : ''}`;
            item.innerHTML = `<small>${d.toLocaleDateString('en-US',{weekday:'short'})}</small><b>${d.getDate()}</b>`;
            item.onclick = () => { state.date = iso; state.time = null; initBooking(); validate(); };
            rib.appendChild(item);
        }
        renderTimes();
    }

    function togglePill(el) { const target = el.nextElementSibling; const isOpen = target.classList.contains('active'); document.querySelectorAll('.sub-grid').forEach(g => g.classList.remove('active')); if(!isOpen) target.classList.add('active'); }

    function renderTimes() { renderG('morning-grid', [9,10,11]); renderG('afternoon-grid', [12,13,14,15,16]); renderG('evening-grid', [17,18,19,20,21]); }
    function renderG(id, hrs) {
        const grid = document.getElementById(id); const curB = state.isAdmin ? state.loggedBarber : state.barber;
        grid.innerHTML = hrs.flatMap(h => ['00', '30'].map(m => {
            const t = `${h}:${m}`; const b = db.find(x => x.date === state.date && x.time === t && x.barber === curB);
            let cls = state.time === t ? 'selected' : ''; let lbl = t;
            if(b) { cls = state.isAdmin ? 'admin-booked' : 'booked'; lbl = state.isAdmin ? b.name : '‚úñ'; }
            return `<div class="t-chip ${cls}" onclick="handleChip('${t}', ${b ? JSON.stringify(b) : null})">${lbl}</div>`;
        })).join('');
    }

    function handleChip(t, booking) {
        if(booking && state.isAdmin) {
            state.activeBookingId = booking.id;
            state.activeFirebaseKey = booking.firebaseKey;
            document.getElementById('edit-client-name').innerText = "‚öôÔ∏è " + booking.name;
            document.getElementById('edit-date').value = booking.date;
            const sel = document.getElementById('edit-time-select'); sel.innerHTML = '';
            for(let i=9; i<=21; i++) ['00','30'].forEach(m => { let v = `${i}:${m}`; sel.innerHTML += `<option value="${v}" ${v===booking.time?'selected':''}>${v}</option>`; });
            document.getElementById('edit-modal').classList.add('active');
        } else if(!booking) { state.time = t; renderTimes(); validate(); }
    }

    function manualDate(v) { state.date = v; state.time = null; initBooking(); validate(); }
    function validate() { document.getElementById('book-btn').disabled = !(state.services.length && state.time); }
    function openActionModal() { document.getElementById('details-modal').classList.add('active'); }

    function finalize() {
        const n = document.getElementById('cust-name').value; const p = document.getElementById('cust-phone').value;
        if(!n || p.length < 10) return alert(state.lang==='hi' ? "‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§π‡•Ä ‡§®‡§æ‡§Æ ‡§î‡§∞ 10 ‡§Ö‡§Ç‡§ï‡•ã‡§Ç ‡§ï‡§æ ‡§®‡§Ç‡§¨‡§∞ ‡§≠‡§∞‡•á‡§Ç" : "Enter valid name and 10-digit number");
        const bN = state.isAdmin ? state.loggedBarber : state.barber;
        dbRef.push({id:Date.now(), name:n, phone:p, barber:bN, date:state.date, time:state.time, services:state.services});
        if(!state.isAdmin) window.open(`https://wa.me/${WA}?text=GALAXY BOOKING: ${n} | ${bN} | ${state.date} @ ${state.time}`);
        location.reload();
    }

    function openAdminLogin() { document.getElementById('admin-modal').classList.add('active'); }
    function adminLogin() {
        const p = document.getElementById('admin-pin').value;
        if(pins[p]) { 
            state.isAdmin = true; state.loggedBarber = pins[p]; 
            document.getElementById('admin-modal').classList.remove('active'); 
            document.getElementById('admin-banner').style.display = 'block'; 
            document.getElementById('logged-barber').innerText = pins[p]; 
            showView('view-booking'); 
        }
    }
    function saveEdit() {
        dbRef.child(state.activeFirebaseKey).update({ 
            date: document.getElementById('edit-date').value, 
            time: document.getElementById('edit-time-select').value 
        });
        location.reload();
    }
    function deleteBooking() { if(confirm("Cancel?")) { dbRef.child(state.activeFirebaseKey).remove(); location.reload(); } }
    function toggleAllS() { state.showAll = !state.showAll; renderServices(); }
</script>
</body>
</html>
